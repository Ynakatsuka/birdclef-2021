project: birdclef-2021
version: 1
run: train
seed: 1213
numexpr_max_threads: '48'
disable_warnings: true
print_config: false
work_dir: ${hydra:runtime.cwd}
data_dir: ${work_dir}/data/
input_dir: ${work_dir}/data/input
save_dir: ${work_dir}/data/output
experiment_name: ${hydra:job.override_dirname}
augmentation:
  train:
  - name: Normalize
    params: null
  validation:
  - name: Normalize
    params: null
  test:
  - name: Normalize
    params: null
dataset:
  dataset:
    name: WaveformDataset
    params:
      csv_filename: ${fold.csv_filename}
      image_column: filename
      target_column: ${competition.target_column}
      target_unique_values: ${competition.target_unique_values}
      input_dir: ${input_dir}
      period: 20
      sample_rate: 32000
      num_fold: 5
      idx_fold: 0
    splits:
    - mode: train
      split: train
    - mode: validation
      split: validation
    - mode: test
      split: test
  transform:
    name: base_audio_transform
    num_preprocessor: 24
fold:
  csv_filename: train_fold_v000.csv
  fold:
    _target_: sklearn.model_selection.StratifiedKFold
    n_splits: 5
    random_state: ${seed}
    shuffle: true
trainer:
  skip_training: false
  train:
    batch_size: 64
    backbone_lr_ratio: null
    encoder_lr_ratio: null
  evaluation:
    batch_size: 128
    save_prediction: true
    dirpath: ${save_dir}/predictions/oof/
    name: ${experiment_name}_fold_${dataset.dataset.params.idx_fold}.npy
  trainer:
    resume_from_checkpoint: null
    max_epochs: 1
    check_val_every_n_epoch: 1
    accumulate_grad_batches: 1
    gpus:
    - 0
    - 1
    accelerator: ddp
    sync_batchnorm: true
    auto_lr_find: false
    auto_scale_batch_size: false
    benchmark: true
    deterministic: true
    num_sanity_val_steps: 0
  inference:
    dirpath: ${save_dir}/predictions/
    filename: ${experiment_name}_fold_${dataset.dataset.params.idx_fold}_{epoch:03d}.pkl
  logger:
    _target_: pytorch_lightning.loggers.WandbLogger
    project: ${project}
    name: ${experiment_name}
  callbacks:
    ModelCheckpoint:
      _target_: pytorch_lightning.callbacks.ModelCheckpoint
      monitor: val_loss
      save_last: false
      save_top_k: 5
      dirpath: ${save_dir}/models/
      filename: ${experiment_name}_fold_${dataset.dataset.params.idx_fold}_{epoch:03d}
  model:
    name: SED
    params:
      num_classes: 397
      backbone:
        name: tf_efficientnet_b0_ns
        params:
          in_channels: 1
          pretrained: true
      n_fft: 2048
      hop_length: 512
      sample_rate: ${dataset.dataset.params.sample_rate}
      n_mels: 128
      fmin: 20
      fmax: 16000
  loss:
    name: BCEFocal2WayLossHook
  metrics:
    rowwise_micro_f1_30:
      name: rowwise_micro_f1
      params:
        threshold: 0.3
    rowwise_micro_f1_50:
      name: rowwise_micro_f1
      params:
        threshold: 0.5
    rowwise_micro_f1_70:
      name: rowwise_micro_f1
      params:
        threshold: 0.7
    mAP:
      name: mAP
  optimizer:
    name: RAdam
    params:
      lr: 0.001
      weight_decay: 0.01
  scheduler: null
  lightning_module:
    name: LightningModuleBase
  hooks:
    post_forward:
      name: KeySelectPostForwardHook
competition:
  train_path: ${input_dir}/train_metadata.csv
  target_column: primary_label
  target_unique_values:
  - acafly
  - acowoo
  - aldfly
  - ameavo
  - amecro
  - amegfi
  - amekes
  - amepip
  - amered
  - amerob
  - amewig
  - amtspa
  - andsol1
  - annhum
  - astfly
  - azaspi1
  - babwar
  - baleag
  - balori
  - banana
  - banswa
  - banwre1
  - barant1
  - barswa
  - batpig1
  - bawswa1
  - bawwar
  - baywre1
  - bbwduc
  - bcnher
  - belkin1
  - belvir
  - bewwre
  - bkbmag1
  - bkbplo
  - bkbwar
  - bkcchi
  - bkhgro
  - bkmtou1
  - bknsti
  - blbgra1
  - blbthr1
  - blcjay1
  - blctan1
  - blhpar1
  - blkpho
  - blsspa1
  - blugrb1
  - blujay
  - bncfly
  - bnhcow
  - bobfly1
  - bongul
  - botgra
  - brbmot1
  - brbsol1
  - brcvir1
  - brebla
  - brncre
  - brnjay
  - brnthr
  - brratt1
  - brwhaw
  - brwpar1
  - btbwar
  - btnwar
  - btywar
  - bucmot2
  - buggna
  - bugtan
  - buhvir
  - bulori
  - burwar1
  - bushti
  - butsal1
  - buwtea
  - cacgoo1
  - cacwre
  - calqua
  - caltow
  - cangoo
  - canwar
  - carchi
  - carwre
  - casfin
  - caskin
  - caster1
  - casvir
  - categr
  - ccbfin
  - cedwax
  - chbant1
  - chbchi
  - chbwre1
  - chcant2
  - chispa
  - chswar
  - cinfly2
  - clanut
  - clcrob
  - cliswa
  - cobtan1
  - cocwoo1
  - cogdov
  - colcha1
  - coltro1
  - comgol
  - comgra
  - comloo
  - commer
  - compau
  - compot1
  - comrav
  - comyel
  - coohaw
  - cotfly1
  - cowscj1
  - cregua1
  - creoro1
  - crfpar
  - cubthr
  - daejun
  - dowwoo
  - ducfly
  - dusfly
  - easblu
  - easkin
  - easmea
  - easpho
  - eastow
  - eawpew
  - eletro
  - eucdov
  - eursta
  - fepowl
  - fiespa
  - flrtan1
  - foxspa
  - gadwal
  - gamqua
  - gartro1
  - gbbgul
  - gbwwre1
  - gcrwar
  - gilwoo
  - gnttow
  - gnwtea
  - gocfly1
  - gockin
  - gocspa
  - goftyr1
  - gohque1
  - goowoo1
  - grasal1
  - grbani
  - grbher3
  - grcfly
  - greegr
  - grekis
  - grepew
  - grethr1
  - gretin1
  - greyel
  - grhcha1
  - grhowl
  - grnher
  - grnjay
  - grtgra
  - grycat
  - gryhaw2
  - gwfgoo
  - haiwoo
  - heptan
  - hergul
  - herthr
  - herwar
  - higmot1
  - hofwoo1
  - houfin
  - houspa
  - houwre
  - hutvir
  - incdov
  - indbun
  - kebtou1
  - killde
  - labwoo
  - larspa
  - laufal1
  - laugul
  - lazbun
  - leafly
  - leasan
  - lesgol
  - lesgre1
  - lesvio1
  - linspa
  - linwoo1
  - littin1
  - lobdow
  - lobgna5
  - logshr
  - lotduc
  - lotman1
  - lucwar
  - macwar
  - magwar
  - mallar3
  - marwre
  - mastro1
  - meapar
  - melbla1
  - monoro1
  - mouchi
  - moudov
  - mouela1
  - mouqua
  - mouwar
  - mutswa
  - naswar
  - norcar
  - norfli
  - normoc
  - norpar
  - norsho
  - norwat
  - nrwswa
  - nutwoo
  - oaktit
  - obnthr1
  - ocbfly1
  - oliwoo1
  - olsfly
  - orbeup1
  - orbspa1
  - orcpar
  - orcwar
  - orfpar
  - osprey
  - ovenbi1
  - pabspi1
  - paltan1
  - palwar
  - pasfly
  - pavpig2
  - phivir
  - pibgre
  - pilwoo
  - pinsis
  - pirfly1
  - plawre1
  - plaxen1
  - plsvir
  - plupig2
  - prowar
  - purfin
  - purgal2
  - putfru1
  - pygnut
  - rawwre1
  - rcatan1
  - rebnut
  - rebsap
  - rebwoo
  - redcro
  - reevir1
  - rehbar1
  - relpar
  - reshaw
  - rethaw
  - rewbla
  - ribgul
  - rinkin1
  - roahaw
  - robgro
  - rocpig
  - rotbec
  - royter1
  - rthhum
  - rtlhum
  - ruboro1
  - rubpep1
  - rubrob
  - rubwre1
  - ruckin
  - rucspa1
  - rucwar
  - rucwar1
  - rudpig
  - rudtur
  - rufhum
  - rugdov
  - rumfly1
  - runwre1
  - rutjac1
  - saffin
  - sancra
  - sander
  - savspa
  - saypho
  - scamac1
  - scatan
  - scbwre1
  - scptyr1
  - scrtan1
  - semplo
  - shicow
  - sibtan2
  - sinwre1
  - sltred
  - smbani
  - snogoo
  - sobtyr1
  - socfly1
  - solsan
  - sonspa
  - soulap1
  - sposan
  - spotow
  - spvear1
  - squcuc1
  - stbori
  - stejay
  - sthant1
  - sthwoo1
  - strcuc1
  - strfly1
  - strsal1
  - stvhum2
  - subfly
  - sumtan
  - swaspa
  - swathr
  - tenwar
  - thbeup1
  - thbkin
  - thswar1
  - towsol
  - treswa
  - trogna1
  - trokin
  - tromoc
  - tropar
  - tropew1
  - tuftit
  - tunswa
  - veery
  - verdin
  - vigswa
  - warvir
  - wbwwre1
  - webwoo1
  - wegspa1
  - wesant1
  - wesblu
  - weskin
  - wesmea
  - westan
  - wewpew
  - whbman1
  - whbnut
  - whcpar
  - whcsee1
  - whcspa
  - whevir
  - whfpar1
  - whimbr
  - whiwre1
  - whtdov
  - whtspa
  - whwbec1
  - whwdov
  - wilfly
  - willet1
  - wilsni1
  - wiltur
  - wlswar
  - wooduc
  - woothr
  - wrenti
  - y00475
  - yebcha
  - yebela1
  - yebfly
  - yebori1
  - yebsap
  - yebsee1
  - yefgra1
  - yegvir
  - yehbla
  - yehcar1
  - yelgro
  - yelwar
  - yeofly1
  - yerwar
  - yeteup1
  - yetvir
